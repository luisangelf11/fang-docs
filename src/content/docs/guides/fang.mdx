---
title: La Clase Fang
description: Referencia completa de los m茅todos p煤blicos y configuraci贸n del motor de Fang JS.
---

import { Steps, Aside, Tabs, TabItem } from "@astrojs/starlight/components";

La clase `Fang` es la columna vertebral de tu aplicaci贸n. Es una capa ligera construida sobre el m贸dulo nativo `http` de Node.js que gestiona el enrutamiento, los middlewares y el ciclo de vida de las peticiones.

## M茅todos de Enrutamiento (HTTP)

Fang proporciona m茅todos intuitivos para registrar rutas. Cada m茅todo acepta una ruta y una secuencia de middlewares (incluyendo el controlador final).

### `app.get()`, `post()`, `put()`, `patch()`, `delete()`

Registra una ruta para un m茅todo HTTP espec铆fico.

```typescript
app.get("/users", (ctx) => ctx.ok(users));
app.post("/users", async (ctx) => {
  const data = await ctx.body(UserSchema);
  // ... l贸gica
});
```

## Gesti贸n de Middlewares

### `app.use(middleware)`

Registra un middleware global. Estos middlewares se ejecutan en todas las peticiones que entren al servidor, antes de los middlewares espec铆ficos de cada ruta.

```typescript
app.use(async (ctx, next) => {
  const start = Date.now();
  await next(); // Pasa al siguiente middleware o ruta
  console.log(`Tiempo de respuesta: ${Date.now() - start}ms`);
});
```

## Organizaci贸n y Modularizaci贸n

### `app.group(prefix, callback?)`

Crea un grupo de rutas con un prefijo com煤n. Es la herramienta principal para mantener tu c贸digo organizado y modular.

1. prefix: El path base (ej: /api/v1).

2. callback: (Opcional) Una funci贸n que recibe una instancia de RouteGroup.

```typescript
// Definici贸n modular
app.group("/api/v1", (group) => {
  group.get("/profile", (ctx) => { ... });
});

// O usando una clase controlador con m茅todo est谩tico (Recomendado)
app.group("/api/v2", UserController.register);
```

## Configuraci贸n del Servidor

### `app.setTimeout(ms)`

Establece un tiempo de espera global para todas las peticiones. Si el servidor no responde en el tiempo indicado, Fang enviar谩 autom谩ticamente un error 504 Gateway Timeout.

```typescript
app.setTimeout(5000); // 5 segundos de timeout
```

### `app.onError(handler)`

Define un manejador de errores global personalizado. Si no se define, Fang usar谩 su manejador gen茅rico que devuelve un error 500 o el estatus de una HttpException.

```typescript
app.onError((err, ctx) => {
    console.error("Error capturado:", err.message);
    ctx.json({
    success: false,
    error: err.name,
    message: err.message
    }, 500);
});
```

### `app.listen(port?, callback?)`

1. port: Puerto a escuchar (Por defecto: 3000).

2. callback: Funci贸n que se ejecuta cuando el servidor est谩 listo. Si no se provee, Fang muestra un log estilizado autom谩ticamente.

```typescript
app.listen(8080, () => {
  console.log("Cazando en el puerto 8080... ");
});
```

## Flujo de Ejecuci贸n Interna

Para entender c贸mo Fang procesa tus peticiones, este es el orden jer谩rquico:

<Steps>
1. **Request Timeout**: Se inicia el contador de tiempo configurado.
2. **Context Creation**: Se crea el objeto ctx unificando req y res.
3. **Global Middlewares**: Se ejecutan todos los app.use().
4. **Route Matching**: Se busca la ruta en el Router.
5. **Route Middlewares**: Se ejecutan los middlewares espec铆ficos de la ruta encontrada.
6. **Execution**: Se ejecuta la l贸gica final del endpoint.
7. **Error Handling**: Si algo falla en cualquier punto, salta al onError.
</Steps>

<Aside type="caution" title="Importante">
  {" "}
  Fang JS utiliza el Onion Model. Siempre recuerda llamar a await next() en tus
  middlewares si quieres que la ejecuci贸n contin煤e hacia la ruta o los
  siguientes middlewares.{" "}
</Aside>

